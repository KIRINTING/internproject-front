<p-toast></p-toast>
<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>

<div class="card">
    <p-toolbar styleClass="mb-4 gap-2">
        <ng-template pTemplate="left">
            <h2 class="m-0">Daily Logs</h2>
        </ng-template>
        <ng-template pTemplate="right">
            <p-button label="New Log" icon="pi pi-plus" severity="success" (onClick)="openNew()"></p-button>
        </ng-template>
    </p-toolbar>

    <p-table [value]="logs" [loading]="loading" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-sm" responsiveLayout="scroll">

        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="date" style="width: 15%">Date <p-sortIcon field="date"></p-sortIcon></th>
                <th style="width: 45%">Work Details</th>
                <th style="width: 20%">Image</th>
                <th style="width: 20%">Actions</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-log>
            <tr>
                <td>{{ log.date | date: 'yyyy-MM-dd' }}</td>
                <td>
                    <div class="white-space-pre-wrap">{{ log.work_details }}</div>
                </td>
                <td>
                    <p-image *ngIf="log.image_path" [src]="imageBaseUrl + '/' + log.image_path"
                        [alt]="'Image for ' + log.date" width="100" [preview]="true"></p-image>
                    <span *ngIf="!log.image_path" class="text-500 font-italic">No image</span>
                </td>
                <td>
                    <div class="flex gap-2">
                        <p-button icon="pi pi-pencil" severity="success" [rounded]="true" [text]="true"
                            (onClick)="editLog(log)"></p-button>
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [text]="true"
                            (onClick)="deleteLog(log)"></p-button>
                    </div>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="4" class="text-center p-4">No daily logs found. Start by adding one!</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<p-dialog [(visible)]="logDialog" [style]="{width: '500px'}" [header]="dialogHeader" [modal]="true"
    styleClass="p-fluid">
    <ng-template pTemplate="content">
        <app-daily-log-form [studentId]="studentId" [logToEdit]="selectedLog" (formSubmit)="onFormSubmit()"
            (cancel)="hideDialog()">
        </app-daily-log-form>
    </ng-template>
</p-dialog>